<h1>詳細ページ</h1>

<%= image_tag @material.get_image(200, 200) %>
<h3><%= @material.name %></h3>

<%= link_to "編集する", edit_material_path(@material) %>

<div id="favorite_btn_<%= @material.id %>">
  <%= render "public/favorites/btn", material: @material %>
</div>

<p>特徴</p>
<p><%= @material.body %></p>
<p>URL</p>
<%= Rinku.auto_link(@material.url, :all, 'target="_blank"').html_safe %>

<% if user_signed_in? %>
  <%= link_to "コメント/レビューする", new_material_comment_path(@material) %>
<% end %>

<p><i class="fa-regular fa-circle-check"></i>：<%= @material.favorites.count %>件</p>

<p><i class="fa-solid fa-comment"></i>：<%= @material.comments.count %>件</p>

<div class="average-star" data-score=<%= @material.comments.average(:star) %>></div>
<%= @material.comments.average(:star).to_f.round(1) %>

<!-- コメント・レビュー一覧 -->
<% @material.comments.each do |comment| %>
  <%= comment.user.nickname %><br>
  <div id="star_<%= comment.id %>"></div>
  <script>
    $(document).on('turbolinks:load', function() {
      let elem = document.querySelector('#star_<%= comment.id %>');
      if (elem == null) return;
      
      elem.innerHTML = "";
      let opt = {  
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        score: "<%= comment.star %>",
        readOnly: true,
      };
      raty(elem, opt);
    });
  </script>
  <p>良いポイント</p><%= comment.good_comment %>
  <p>使いにくいポイント</p><%= comment.bad_comment %>
  <% if comment.user == current_user %>
    <%= link_to "削除する", material_comment_path(comment.material, comment), method: :delete %>
  <% end %>
<% end %>